function initNavBar() { var e = document.querySelectorAll("#nav-menu > li[data-tab]"); if (e) for (var t = 0; t < e.length; t++)e[t].addEventListener("click", function (t) { for (var n = t.currentTarget, o = 0; o < e.length; o++)e[o].classList.contains("selected") && e[o].classList.remove("selected"); n.classList.add("selected") }) } function initYeah() { function e(e) { var t = e.currentTarget, n = t.getAttribute("data-post"), o = document.getElementById(n), i = document.getElementById("count-" + n); t.disabled = !0; var a = "postID=" + n; t.classList.contains("selected") ? (t.classList.remove("selected"), o.classList.remove("yeah"), i && (i.innerText -= 1), wiiuSound.playSoundByName("SE_OLV_MII_CANCEL", 1)) : (t.classList.add("selected"), o.classList.add("yeah"), i && (i.innerText = ++i.innerText), wiiuSound.playSoundByName("SE_WAVE_MII_ADD", 1)), POST("/posts/empathy", a, function (e) { var n = JSON.parse(e.response); if (!n || 200 !== n.status) return wiiuErrorViewer.openByCode(1155927); t.disabled = !1, i && (i.innerText = n.count) }) } var t = document.querySelectorAll("button[data-post].yeah-button"); if (t) for (var n = 0; n < t.length; n++)t[n].removeEventListener("click", e), t[n].addEventListener("click", e) } function initTabs() { function e(e) { e.preventDefault(); for (var n = e.currentTarget, o = n.children[0], i = 0; i < t.length; i++)t[i].classList.contains("selected") && t[i].classList.remove("selected"); n.classList.add("selected"), GET(o.getAttribute("href") + "?pjax=true", function (e) { var t = e.response; t && 200 === e.status && (document.getElementsByClassName("tab-body")[0].innerHTML = e.response, window.history.pushState({ url: o.href, title: "", scrollPos: [0, 0] }, "", o.href), initPosts(), initMorePosts()) }) } var t = document.querySelectorAll(".tab-button"); if (t) for (var n = 0; n < t.length; n++)t[n].removeEventListener("click", e), t[n].addEventListener("click", e) } function initPosts() { var e = document.querySelectorAll(".post-content[data-href]"); if (e) { for (var t = 0; t < e.length; t++)e[t].addEventListener("click", function (e) { pjax.loadUrl(e.currentTarget.getAttribute("data-href")) }); initYeah(), initSpoilers() } } function initMorePosts() { var e = document.querySelectorAll(".load-more[data-href]"); if (e) for (var t = 0; t < e.length; t++)e[t].addEventListener("click", function (e) { var t = e.currentTarget; GET(t.getAttribute("data-href"), function (e) { var n = e.response; n && 200 === e.status ? (t.parentElement.outerHTML = e.response, initPosts(), initMorePosts()) : t.parentElement.outerHTML = "" }) }) } function initPostModules() { var e = document.querySelectorAll("[data-module-show]"); if (console.log(e), e) for (var t = 0; t < e.length; t++)e[t].addEventListener("click", function (e) { var t = e.currentTarget, n = t.getAttribute("data-module-show"), o = t.getAttribute("data-module-hide"); if (n && o) { document.getElementById(o).style.display = "none", document.getElementById(n).style.display = "block"; var i = t.getAttribute("data-header"), a = t.getAttribute("data-menu"), s = t.getAttribute("data-sound"); s && wiiuSound.playSoundByName(s, 3), document.getElementById("header").style.display = "true" === i ? "block" : "none", document.getElementById("nav-menu").style.display = "true" === a ? "block" : "none", wiiuBrowser.showLoadingIcon(!1), initNewPost() } }) } function initPostEmotion() { var e = document.querySelectorAll("input[data-mii-face-url]"); if (e) for (var t = 0; t < e.length; t++)e[t].addEventListener("click", function (e) { var t = e.currentTarget; document.getElementById("mii-face").src = t.getAttribute("data-mii-face-url"), wiiuSound.playSoundByName(t.getAttribute("data-sound"), 3) }) } function initSounds() { function e(e) { wiiuSound.playSoundByName(e.currentTarget.getAttribute("data-sound"), 3) } var t = document.querySelectorAll("[data-sound]"); if (t) for (var n = 0; n < t.length; n++)t[n].addEventListener("click", e) } function initScreenShots() { document.getElementById("top-screen").src = "data:image/png;base64," + wiiuMainApplication.getScreenShot(!0), document.getElementById("bottom-screen").src = "data:image/png;base64," + wiiuMainApplication.getScreenShot(!1) } function initNewPost() { initPostEmotion(), initScreenShots() } function initSpoilers() { var e = document.querySelectorAll("button[data-post-id]"); if (e) for (var t = 0; t < e.length; t++)e[t].addEventListener("click", function (e) { var t = e.currentTarget; document.getElementById("post-" + t.getAttribute("data-post-id")).classList.remove("spoiler"), t.outerHTML = "" }) } function initAll() { initNavBar(), initTabs(), initPosts(), initMorePosts(), initPostModules(), initSounds(), checkForUpdates(), pjax.refresh() } function hideScreenShots() { document.getElementById("screenshot-toggle").checked = !1 } function chooseScreenShot(e) { var t = document.getElementById("screenshot-value"); switch (e) { case 0: t.value = wiiuMainApplication.getScreenShot(!0), document.getElementById("screenshot-value").disabled = !1; break; case 1: t.value = wiiuMainApplication.getScreenShot(!1), document.getElementById("screenshot-value").disabled = !1; break; default: t.value = "", document.getElementById("screenshot-value").disabled = !0 }hideScreenShots() } function follow(e) { var t = e.getAttribute("data-community-id"), n = document.getElementById("followers"); e.disabled = !0; var o = "id=" + t; e.classList.contains("checked") ? (e.classList.remove("checked"), wiiuSound.playSoundByName("SE_OLV_MII_CANCEL", 1)) : (e.classList.add("checked"), wiiuSound.playSoundByName("SE_WAVE_MII_ADD", 1)), POST(e.getAttribute("data-url"), o, function (t) { var o = JSON.parse(t.response); if (!o || 200 !== o.status) return wiiuErrorViewer.openByCode(1155927); e.disabled = !1, n.innerText = o.count }) } function newPainting(e) { wiiuMemo.open(e), setTimeout(function () { wiiuMemo.isFinish() && (console.log("running!"), document.getElementById("memo").src = "data:image/png;base64," + wiiuMemo.getImage(!1), document.getElementById("memo-value").value = wiiuMemo.getImage(!0)) }, 250) } function stopLoading() { "undefined" != typeof wiiuBrowser && void 0 !== wiiuBrowser.endStartUp && (wiiuBrowser.endStartUp(), wiiuSound.playSoundByName("BGM_OLV_MAIN", 3), setTimeout(function () { wiiuSound.playSoundByName("BGM_OLV_MAIN_LOOP_NOWAIT", 3) }, 9e4), wiiuBrowser.lockUserOperation(!1)) } function exit() { wiiu.gamepad.update(), 8192 === wiiu.gamepad.hold || 40960 === wiiu.gamepad.hold ? alert("Debug Menu") : (wiiuSound.playSoundByName("SE_WAVE_EXIT", 1), wiiuBrowser.closeApplication()) } function deletePost(e) { var t = e.getAttribute("data-post"); if (t) { var n = wiiuDialog.confirm("Are you sure you want to delete your post? This cannot be undone.", "No", "Yes"); n && DELETE("/posts/" + t, function (e) { return e && 200 === e.status ? (console.log(e), alert("Post has been deleted."), window.location.href = e.responseText) : wiiuErrorViewer.openByCodeAndMessage("5980030", "Post was not able to be deleted. Please try again later.") }) } } function reportPost(e) { var t = e.getAttribute("data-post"), n = document.getElementById("report-launcher"), o = document.getElementById("report-form"), i = document.getElementById("report-post-id"); t && n && o && i && (o.action = "/posts/" + t + "/report", i.value = t, console.log(t.replace(/(\d{3})(\d{4})(\d{3})(\d{4})(\d{3})(\d{4})/, "$1-$2-$3-$4-$5-$6")), n.click()) } function checkForUpdates() { GET("/users/notifications.json", function (e) { var t = JSON.parse(e.responseText), n = document.getElementById("message-badge"), o = document.getElementById("news-badge"); t.message_count > 0 && t.message_count < 99 ? (n.innerHTML = t.message_count, n.style.display = "block") : t.message_count >= 99 ? (n.innerHTML = "99+", n.style.display = "block") : (n.innerHTML = "", n.style.display = "none"), t.notification_count > 0 && t.notification_count < 99 ? (o.innerHTML = t.notification_count, o.style.display = "block") : t.notification_count >= 99 ? (o.innerHTML = "99+", o.style.display = "block") : (o.innerHTML = "", o.style.display = "none") }) } function POST(e, t, n) { wiiuBrowser.showLoadingIcon(!0); var o = new XMLHttpRequest; o.onreadystatechange = function () { if (4 === this.readyState) return wiiuBrowser.showLoadingIcon(!1), n(this) }, o.open("POST", e, !0), o.setRequestHeader("Content-type", "application/x-www-form-urlencoded"), o.send(t) } function GET(e, t) { wiiuBrowser.showLoadingIcon(!0); var n = new XMLHttpRequest; n.onreadystatechange = function () { if (4 === this.readyState) return wiiuBrowser.showLoadingIcon(!1), t(this) }, n.open("GET", e, !0), n.send() } function DELETE(e, t) { wiiuBrowser.showLoadingIcon(!0); var n = new XMLHttpRequest; n.onreadystatechange = function () { if (4 === this.readyState) return wiiuBrowser.showLoadingIcon(!1), t(this) }, n.open("DELETE", e, !0), n.send() } function back() { wiiuBrowser.canHistoryBack() && (document.getElementById("nav-menu-back").classList.add("selected"), wiiuSound.playSoundByName("SE_OLV_MII_CANCEL", 1), history.back(), document.getElementById("nav-menu").style.display = "block") } function input() { if (wiiu.gamepad.update(), 0 !== wiiu.gamepad.isDataValid) switch (wiiu.gamepad.hold) { case 12: return wiiuBrowser.lockUserOperation(!1); case 4096: return wiiuSound.playSoundByName("SE_WAVE_BALLOON_OPEN", 1), location.reload(); case 16384: back() } } var scrollPosition, pjax, updateCheck = setInterval(checkForUpdates, 3e4), inputCheck = setInterval(input, 100); console.debug("Document initialized:" + window.location.href), document.addEventListener("pjax:send", function () { console.debug("Event: pjax:send", arguments), wiiuBrowser.showLoadingIcon(!0) }), document.addEventListener("pjax:complete", function () { console.debug("Event: pjax:complete", arguments), wiiuBrowser.showLoadingIcon(!1) }), document.addEventListener("pjax:error", function (e) { wiiuErrorViewer.openByCodeAndMessage(5984e3, "Error: Unable to load element. \nPlease send the error code and what you were doing in #support"), console.debug(e), wiiuBrowser.showLoadingIcon(!1) }), document.addEventListener("pjax:success", function () { console.debug("Event: pjax:success", arguments), wiiuBrowser.showLoadingIcon(!1); var e = document.getElementById("nav-menu-back"), t = document.getElementById("nav-menu-exit"); wiiuBrowser.canHistoryBack() ? (e.classList.remove("selected"), e.classList.remove("none"), t.classList.add("none")) : (e.classList.remove("selected"), e.classList.add("none"), t.classList.remove("none")), initAll() }), document.addEventListener("DOMContentLoaded", function () { pjax = new Pjax({ elements: "a[data-pjax]", selectors: ["title", "#body"], switches: { "#nav-menu": Pjax.switches.replaceNode, ".tab-body": Pjax.switches.replaceNode } }), console.debug("Pjax initialized.", pjax), initAll(), stopLoading() });
