var scrollPosition,pjax,updateCheck=setInterval(checkForUpdates,3e4),inputCheck=setInterval(input,100);function initNavBar(){var e=document.querySelectorAll("#nav-menu > li");if(e)for(var t=0;t<e.length;t++)e[t].addEventListener("click",(function(t){for(var n=t.currentTarget,i=0;i<e.length;i++)e[i].classList.contains("selected")&&e[i].classList.remove("selected");n.classList.add("selected")}))}function initYeah(){var e=document.querySelectorAll("button[data-post]");if(e)for(var t=0;t<e.length;t++)e[t].removeEventListener("click",n),e[t].addEventListener("click",n);function n(e){var t=e.currentTarget,n=t.getAttribute("data-post"),i=document.getElementById(n),o=document.getElementById("count-"+n);t.disabled=!0;var a="postID="+n;t.classList.contains("selected")?(t.classList.remove("selected"),i.classList.remove("yeah"),o.innerText-=1,wiiuSound.playSoundByName("SE_OLV_MII_CANCEL",1)):(t.classList.add("selected"),i.classList.add("yeah"),o.innerText=++o.innerText,wiiuSound.playSoundByName("SE_WAVE_MII_ADD",1)),POST("/posts/empathy",a,(function(e){var n=JSON.parse(e.response);if(!n||200!==n.status)return wiiuErrorViewer.openByCode(1155927);t.disabled=!1,o.innerText=n.count}))}}function initTabs(){var e=document.querySelectorAll(".tab-button");if(e)for(var t=0;t<e.length;t++)e[t].removeEventListener("click",n),e[t].addEventListener("click",n);function n(t){t.preventDefault();for(var n=t.currentTarget,i=n.children[0],o=0;o<e.length;o++)e[o].classList.contains("selected")&&e[o].classList.remove("selected");n.classList.add("selected"),GET(i.getAttribute("href")+"?pjax=true",(function(e){e.response&&200===e.status&&(document.getElementsByClassName("tab-body")[0].innerHTML=e.response,window.history.pushState({url:i.href,title:"",scrollPos:[0,0]},"",i.href),initPosts(),initYeah())}))}}function initPosts(){var e=document.querySelectorAll(".post-content[data-href]");if(e)for(var t=0;t<e.length;t++)e[t].addEventListener("click",(function(e){pjax.loadUrl(e.currentTarget.getAttribute("data-href"))}))}function initMorePosts(){var e=document.querySelectorAll(".load-more[data-href]");if(e)for(var t=0;t<e.length;t++)e[t].addEventListener("click",(function(e){var t=e.currentTarget;GET(t.getAttribute("data-href"),(function(e){e.response&&200===e.status?(t.parentElement.outerHTML=e.response,initYeah(),initPosts(),initMorePosts()):t.parentElement.remove()}))}))}function initPostModules(){var e=document.querySelectorAll("[data-module-show]");if(console.log(e),e)for(var t=0;t<e.length;t++)e[t].addEventListener("click",(function(e){var t=e.currentTarget,n=t.getAttribute("data-module-show"),i=t.getAttribute("data-module-hide"),o=t.getAttribute("data-header"),a=t.getAttribute("data-menu"),s=t.getAttribute("data-sound");s&&wiiuSound.playSoundByName(s,3),n&&i&&(document.getElementById(i).style.display="none",document.getElementById(n).style.display="block",document.getElementById("header").style.display="true"===o?"block":"none",document.getElementById("nav-menu").style.display="true"===a?"block":"none",wiiuBrowser.showLoadingIcon(!1),initNewPost())}))}function initPostEmotion(){var e=document.querySelectorAll("input[data-mii-face-url]");if(e)for(var t=0;t<e.length;t++)e[t].addEventListener("click",(function(e){var t=e.currentTarget;document.getElementById("mii-face").src=t.getAttribute("data-mii-face-url"),wiiuSound.playSoundByName(t.getAttribute("data-sound"),3)}))}function initSounds(){var e=document.querySelectorAll("[data-sound]");if(e)for(var t=0;t<e.length;t++)e[t].addEventListener("click",(function(e){wiiuSound.playSoundByName(e.currentTarget.getAttribute("data-sound"),3)}))}function initScreenShots(){document.getElementById("top-screen").src="data:image/png;base64,"+wiiuMainApplication.getScreenShot(!0),document.getElementById("bottom-screen").src="data:image/png;base64,"+wiiuMainApplication.getScreenShot(!1)}function initNewPost(){initPostEmotion(),initScreenShots()}function initAll(){initNavBar(),initYeah(),initTabs(),initPosts(),initMorePosts(),initPostModules(),pjax.refresh()}function hideScreenShots(){document.getElementById("screenshot-toggle").checked=!1}function chooseScreenShot(e){var t=document.getElementById("screenshot-value");switch(e){case 0:t.value=wiiuMainApplication.getScreenShot(!0),document.getElementById("screenshot-value").disabled=!1;break;case 1:t.value=wiiuMainApplication.getScreenShot(!1),document.getElementById("screenshot-value").disabled=!1;break;default:t.value="",document.getElementById("screenshot-value").disabled=!0}hideScreenShots()}function follow(e){var t=e.getAttribute("data-community-id"),n=document.getElementById("followers");e.disabled=!0;var i="id="+t;e.classList.contains("checked")?(e.classList.remove("checked"),wiiuSound.playSoundByName("SE_OLV_MII_CANCEL",1)):(e.classList.add("checked"),wiiuSound.playSoundByName("SE_WAVE_MII_ADD",1)),POST(e.getAttribute("data-url"),i,(function(t){var i=JSON.parse(t.response);if(!i||200!==i.status)return wiiuErrorViewer.openByCode(1155927);e.disabled=!1,n.innerText=i.count}))}function newPainting(e){wiiuMemo.open(e),setTimeout((function(){wiiuMemo.isFinish()&&(console.log("running!"),document.getElementById("memo").src="data:image/png;base64,"+wiiuMemo.getImage(!1),document.getElementById("memo-value").value=wiiuMemo.getImage(!0))}),250)}function stopLoading(){"undefined"!=typeof wiiuBrowser&&void 0!==wiiuBrowser.endStartUp&&(wiiuBrowser.endStartUp(),wiiuSound.playSoundByName("BGM_OLV_MAIN",3),setTimeout((function(){wiiuSound.playSoundByName("BGM_OLV_MAIN_LOOP_NOWAIT",3)}),9e4),wiiuBrowser.lockUserOperation(!1))}function exit(){wiiu.gamepad.update(),8192===wiiu.gamepad.hold||40960===wiiu.gamepad.hold?alert("Debug Menu"):(wiiuSound.playSoundByName("SE_WAVE_EXIT",1),wiiuBrowser.closeApplication())}function checkForUpdates(){var e=new XMLHttpRequest;e.onreadystatechange=function(){if(4===this.readyState&&200===this.status){var e=JSON.parse(this.responseText),t=document.getElementById("message-badge"),n=document.getElementById("news-badge");e.message_count>0&&e.message_count<99?(t.innerHTML=e.message_count,t.style.display="unset"):e.message_count>=99?(t.innerHTML="99+",t.style.display="unset"):(t.innerHTML="",t.style.display="none"),e.notification_count>0&&e.notification_count<99?(n.innerHTML=e.notification_count,n.style.display="unset"):e.notification_count>=99?(n.innerHTML="99+",n.style.display="unset"):(n.innerHTML="",n.style.display="none")}},e.open("GET","/notifications.json",!0),e.send()}function POST(e,t,n){wiiuBrowser.showLoadingIcon(!0);var i=new XMLHttpRequest;i.onreadystatechange=function(){if(4===this.readyState)return wiiuBrowser.showLoadingIcon(!1),n(this)},i.open("POST",e,!0),i.setRequestHeader("Content-type","application/x-www-form-urlencoded"),i.send(t)}function GET(e,t){wiiuBrowser.showLoadingIcon(!0);var n=new XMLHttpRequest;n.onreadystatechange=function(){if(4===this.readyState)return wiiuBrowser.showLoadingIcon(!1),t(this)},n.open("GET",e,!0),n.send()}function input(){if(wiiu.gamepad.update(),0!==wiiu.gamepad.isDataValid)switch(wiiu.gamepad.hold){case 12:return wiiuBrowser.lockUserOperation(!1);case 4096:return wiiuSound.playSoundByName("SE_WAVE_BALLOON_OPEN",1),location.reload();case 16384:if(wiiuSound.playSoundByName("SE_OLV_MII_CANCEL",1),wiiuBrowser.canHistoryBack())return history.back()}}console.debug("Document initialized:"+window.location.href),document.addEventListener("pjax:send",(function(){console.debug("Event: pjax:send",arguments),wiiuBrowser.showLoadingIcon(!0)})),document.addEventListener("pjax:complete",(function(){console.debug("Event: pjax:complete",arguments),wiiuBrowser.showLoadingIcon(!1)})),document.addEventListener("pjax:error",(function(e){wiiuErrorViewer.openByCodeAndMessage(5984e3,"Error: Unable to load element. \nPlease send the error code and what you were doing in #support"),console.debug(e),wiiuBrowser.showLoadingIcon(!1)})),document.addEventListener("pjax:success",(function(){console.debug("Event: pjax:success",arguments),wiiuBrowser.showLoadingIcon(!1),initAll()})),document.addEventListener("DOMContentLoaded",(function(){pjax=new Pjax({elements:"a[data-pjax]",selectors:["title","#body"],switches:{"#nav-menu":Pjax.switches.replaceNode,".tab-body":Pjax.switches.replaceNode}}),console.debug("Pjax initialized.",pjax),initAll(),stopLoading()}));