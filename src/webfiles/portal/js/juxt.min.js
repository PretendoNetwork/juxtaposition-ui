var scrollPosition,pjax,isPostModalOpen=!1,updateCheck=setInterval(checkForUpdates,3e4),inputCheck=setInterval(input,100);function initNavBar(){var n=document.querySelectorAll("#nav-menu > li[data-tab]");if(n)for(var e=0;e<n.length;e++)n[e].addEventListener("click",function(e){for(var e=e.currentTarget,t=0;t<n.length;t++)n[t].classList.contains("selected")&&n[t].classList.remove("selected");e.classList.add("selected")})}function initYeah(){var e=document.querySelectorAll("button[data-post].yeah-button");if(e)for(var t=0;t<e.length;t++)e[t].removeEventListener("click",n),e[t].addEventListener("click",n);function n(e){var t=e.currentTarget,n=t.getAttribute("data-post"),o=document.getElementById(n),i=document.getElementById("count-"+n);t.disabled=!0;var a="postID="+n;if(t.classList.contains("selected")){if(t.classList.remove("selected"),o.classList.remove("yeah"),i&&--i.innerText,wiiuSound.playSoundByName("SE_OLV_MII_CANCEL",1),document.querySelector("#post-"+n+" .yeah-list")){var s=document.querySelector("#post-"+n+" .yeah-list"),r=document.querySelector("#nav-menu-me .mii-icon img").src,d=s.children;if(1!=d)for(var c=0;c<d.length;c++)if(d[c].querySelector("img").src===r){s.removeChild(d[c]);break}}}else t.classList.add("selected"),o.classList.add("yeah"),i&&(i.innerText=++i.innerText),wiiuSound.playSoundByName("SE_WAVE_MII_ADD",1),document.querySelector("#post-"+n+" .yeah-list")&&((e=document.createElement("a")).classList.add("mii-icon-container"),e.setAttribute("data-pjax","#body"),e.setAttribute("data-pjax-state",""),(o=document.createElement("img")).classList.add("mii-icon"),o.src=document.querySelector("#nav-menu-me .mii-icon img").src,e.appendChild(o),(s=document.querySelector("#post-"+n+" .yeah-list")).firstChild?s.insertBefore(e,s.firstChild):s.appendChild(e));POST("/posts/empathy",a,function(e){e=JSON.parse(e.response);if(!e||200!==e.status)return wiiuErrorViewer.openByCode(1155927);t.disabled=!1,i&&(i.innerText=e.count)})}}function initTabs(){var o=document.querySelectorAll(".tab-button");if(o)for(var e=0;e<o.length;e++)o[e].removeEventListener("click",t),o[e].addEventListener("click",t);function t(e){e.preventDefault();for(var e=e.currentTarget,t=e.children[0],n=0;n<o.length;n++)o[n].classList.contains("selected")&&o[n].classList.remove("selected");e.classList.add("selected"),GET(t.getAttribute("href")+"?pjax=true",function(e){e.response&&200===e.status&&(document.getElementsByClassName("tab-body")[0].innerHTML=e.response,window.history.pushState({url:t.href,title:"",scrollPos:[0,0]},"",t.href),initPosts(),initMorePosts())})}}function initPosts(){var e=document.querySelectorAll(".post-content[data-href]");if(e){for(var t=0;t<e.length;t++)e[t].addEventListener("click",function(e){pjax.loadUrl(e.currentTarget.getAttribute("data-href"))});initYeah(),initSpoilers()}}function initMorePosts(){var e=document.querySelectorAll(".load-more[data-href]");if(e)for(var t=0;t<e.length;t++)e[t].addEventListener("click",function(e){var t=e.currentTarget;t.disabled=!0,t.innerText="Loading...",GET(t.getAttribute("data-href"),function(e){e.response&&200===e.status?(t.parentElement.outerHTML=e.response,initPosts(),initMorePosts(),t.disabled=!1,t.innerText="Load more posts"):t.parentElement.outerHTML="",t.disabled=!1,t.innerText="Load more posts"})})}function initPostModules(){var e=document.querySelectorAll("[data-module-show]");if(console.log(e),e)for(var t=0;t<e.length;t++)e[t].addEventListener("click",function(e){var t=e.currentTarget,n=t.getAttribute("data-module-show"),e=t.getAttribute("data-module-hide");n&&e&&(isPostModalOpen="add-post-page"===n,document.getElementById(e).style.display="none",document.getElementById(n).style.display="block",e=t.getAttribute("data-header"),n=t.getAttribute("data-menu"),(t=t.getAttribute("data-sound"))&&wiiuSound.playSoundByName(t,3),document.getElementById("header").style.display="true"===e?"block":"none",document.getElementById("nav-menu").style.display="true"===n?"block":"none",wiiuBrowser.showLoadingIcon(!1),initNewPost())})}function initPostEmotion(){var e=document.querySelectorAll("input[data-mii-face-url]");if(e)for(var t=0;t<e.length;t++)e[t].addEventListener("click",function(e){e=e.currentTarget;document.getElementById("mii-face").src=e.getAttribute("data-mii-face-url"),wiiuSound.playSoundByName(e.getAttribute("data-sound"),3)})}function initSounds(){var e=document.querySelectorAll("[data-sound]");if(e)for(var t=0;t<e.length;t++)e[t].removeEventListener("click",n),e[t].addEventListener("click",n);function n(e){wiiuSound.playSoundByName(e.currentTarget.getAttribute("data-sound"),3)}}function initScreenShots(){wiiuMainApplication.getScreenShot(!0)?(document.getElementById("top-screen").src="data:image/png;base64,"+wiiuMainApplication.getScreenShot(!0),document.getElementById("bottom-screen").src="data:image/png;base64,"+wiiuMainApplication.getScreenShot(!1)):(document.getElementById("top-screen").src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC",document.getElementById("bottom-screen").src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC")}function initNewPost(){initPostEmotion(),initScreenShots()}function initSpoilers(){var e=document.querySelectorAll("button[data-post-id]");if(e)for(var t=0;t<e.length;t++)e[t].addEventListener("click",function(e){e=e.currentTarget;document.getElementById("post-"+e.getAttribute("data-post-id")).classList.remove("spoiler"),e.outerHTML=""})}function initAll(){initNavBar(),initTabs(),initPosts(),initMorePosts(),initPostModules(),initSounds(),checkForUpdates(),pjax.refresh()}function hideScreenShots(){document.getElementById("screenshot-toggle").checked=!1}function chooseScreenShot(e){var t=document.getElementById("screenshot-value");switch(e){case 0:t.value=wiiuMainApplication.getScreenShot(!0),document.getElementById("screenshot-value").disabled=!1;break;case 1:t.value=wiiuMainApplication.getScreenShot(!1),document.getElementById("screenshot-value").disabled=!1;break;default:t.value="",document.getElementById("screenshot-value").disabled=!0}hideScreenShots()}function follow(t){var e=t.getAttribute("data-community-id"),n=document.getElementById("followers");t.disabled=!0;e="id="+e;t.classList.contains("checked")?(t.classList.remove("checked"),wiiuSound.playSoundByName("SE_OLV_MII_CANCEL",1)):(t.classList.add("checked"),wiiuSound.playSoundByName("SE_WAVE_MII_ADD",1)),POST(t.getAttribute("data-url"),e,function(e){e=JSON.parse(e.response);if(!e||200!==e.status)return wiiuErrorViewer.openByCode(1155927);t.disabled=!1,n.innerText=e.count})}function newPainting(e){wiiuMemo.open(e),setTimeout(function(){wiiuMemo.isFinish()&&(console.log("running!"),document.getElementById("memo").src="data:image/png;base64,"+wiiuMemo.getImage(!1),document.getElementById("memo-value").value=wiiuMemo.getImage(!0))},250)}function stopLoading(){"undefined"!=typeof wiiuBrowser&&void 0!==wiiuBrowser.endStartUp&&(wiiuBrowser.endStartUp(),wiiuSound.playSoundByName("BGM_OLV_MAIN",3),setTimeout(function(){wiiuSound.playSoundByName("BGM_OLV_MAIN_LOOP_NOWAIT",3)},9e4),wiiuBrowser.lockUserOperation(!1))}function exit(){wiiu.gamepad.update(),8192===wiiu.gamepad.hold||40960===wiiu.gamepad.hold?alert("Debug Menu (totally)"):(wiiuSound.playSoundByName("SE_WAVE_EXIT",1),wiiuBrowser.closeApplication())}function deletePost(e){e=e.getAttribute("data-post");e&&wiiuDialog.confirm("Are you sure you want to delete your post? This cannot be undone.","No","Yes")&&(wiiuDialog.showLoading("Deleting your post..."),DELETE("/posts/"+e,function(e){return e&&200===e.status?(console.log(e),wiiuDialog.hideLoading(),wiiuDialog.alert("Post has been deleted.","Accept"),window.location.href=e.responseText):wiiuErrorViewer.openByCodeAndMessage("5980030","Post was not able to be deleted. Please try again later.")}))}function reportPost(e){var t=e.getAttribute("data-post"),n=document.getElementById("report-launcher"),o=document.getElementById("report-form"),e=document.getElementById("report-post-id");t&&n&&o&&e&&(o.action="/posts/"+t+"/report",e.value=t,console.log(t.replace(/(\d{3})(\d{4})(\d{3})(\d{4})(\d{3})(\d{4})/,"$1-$2-$3-$4-$5-$6")),n.click())}function checkForUpdates(){GET("/notifications.json",function(e){var t=JSON.parse(e.responseText),n=document.getElementById("message-badge"),e=document.getElementById("news-badge");0<t.message_count&&t.message_count<99?(n.innerHTML=t.message_count,n.style.display="block"):99<=t.message_count?(n.innerHTML="99+",n.style.display="block"):(n.innerHTML="",n.style.display="none"),0<t.notification_count&&t.notification_count<99?(e.innerHTML=t.notification_count,e.style.display="block"):99<=t.notification_count?(e.innerHTML="99+",e.style.display="block"):(e.innerHTML="",e.style.display="none")})}function POST(e,t,n){wiiuBrowser.showLoadingIcon(!0);var o=new XMLHttpRequest;o.onreadystatechange=function(){if(4===this.readyState)return wiiuBrowser.showLoadingIcon(!1),n(this)},o.open("POST",e,!0),o.setRequestHeader("Content-type","application/x-www-form-urlencoded"),o.send(t)}function GET(e,t){wiiuBrowser.showLoadingIcon(!0);var n=new XMLHttpRequest;n.onreadystatechange=function(){if(4===this.readyState)return wiiuBrowser.showLoadingIcon(!1),t(this)},n.open("GET",e,!0),n.send()}function DELETE(e,t){wiiuBrowser.showLoadingIcon(!0);var n=new XMLHttpRequest;n.onreadystatechange=function(){if(4===this.readyState)return wiiuBrowser.showLoadingIcon(!1),t(this)},n.open("DELETE",e,!0),n.send()}function back(){wiiuBrowser.canHistoryBack()&&!isPostModalOpen&&(document.getElementById("nav-menu-back").classList.add("selected"),wiiuSound.playSoundByName("SE_OLV_MII_CANCEL",1),history.back(),document.getElementById("nav-menu").style.display="block")}function input(){if(wiiu.gamepad.update(),0!==wiiu.gamepad.isDataValid)switch(wiiu.gamepad.hold){case 12:return wiiuBrowser.lockUserOperation(!1);case 4096:return wiiuSound.playSoundByName("SE_WAVE_BALLOON_OPEN",1),location.reload();case 16384:back()}}console.debug("Document initialized:"+window.location.href),document.addEventListener("pjax:send",function(){console.debug("Event: pjax:send",arguments),wiiuBrowser.showLoadingIcon(!0)}),document.addEventListener("pjax:complete",function(){console.debug("Event: pjax:complete",arguments),wiiuBrowser.showLoadingIcon(!1)}),document.addEventListener("pjax:error",function(e){wiiuErrorViewer.openByCodeAndMessage(5984e3,"Error: Unable to load element. \nPlease send the error code and what you were doing in #support"),console.debug(e),wiiuBrowser.showLoadingIcon(!1)}),document.addEventListener("pjax:success",function(){console.debug("Event: pjax:success",arguments),wiiuBrowser.showLoadingIcon(!1);var e=document.getElementById("nav-menu-back"),t=document.getElementById("nav-menu-exit");wiiuBrowser.canHistoryBack()?(e.classList.remove("selected"),e.classList.remove("none"),t.classList.add("none")):(e.classList.remove("selected"),e.classList.add("none"),t.classList.remove("none")),initAll()}),document.addEventListener("DOMContentLoaded",function(){pjax=new Pjax({elements:"a[data-pjax]",selectors:["title","#body"],switches:{"#nav-menu":Pjax.switches.replaceNode,".tab-body":Pjax.switches.replaceNode}}),console.debug("Pjax initialized.",pjax),initAll(),stopLoading()});